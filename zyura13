#!/bin/bash

REMOTE_PATH="/var/www/pterodactyl/resources/scripts/components/navigation/SideNavigation.tsx"
TIMESTAMP=$(date -u +"%Y-%m-%d-%H-%M-%S")
BACKUP_PATH="${REMOTE_PATH}.bak_${TIMESTAMP}"

echo "ğŸ”§ Modifikasi Sidebar Menu Pterodactyl..."

# Backup file lama
if [ -f "$REMOTE_PATH" ]; then
  mv "$REMOTE_PATH" "$BACKUP_PATH"
  echo "ğŸ“¦ Backup dibuat: $BACKUP_PATH"
fi

# Pastikan folder ada
mkdir -p "$(dirname "$REMOTE_PATH")"
chmod 755 "$(dirname "$REMOTE_PATH")"

# Tulis full code
cat > "$REMOTE_PATH" << 'EOF'
import React from 'react';
import { NavLink } from 'react-router-dom';
import { useStoreState } from '@/state/hooks';

interface NavItem {
    name: string;
    to: string;
    icon: string;
}

export default () => {
    const user = useStoreState(state => state.user.data!);

    const isRootAdmin = user.id === 1;

    const baseMenu: NavItem[] = [
        { name: 'Dashboard', to: '/', icon: 'ğŸ ' },
        { name: 'Servers', to: '/servers', icon: 'ğŸ–¥ï¸' },
        { name: 'Account', to: '/account', icon: 'ğŸ‘¤' },
    ];

    const adminMenu: NavItem[] = [
        { name: 'Users', to: '/admin/users', icon: 'ğŸ‘¥' },
        { name: 'Nodes', to: '/admin/nodes', icon: 'ğŸ§©' },
        { name: 'Locations', to: '/admin/locations', icon: 'ğŸ“' },
        { name: 'Nests', to: '/admin/nests', icon: 'ğŸ“¦' },
        { name: 'Settings', to: '/admin/settings', icon: 'âš™ï¸' },
    ];

    const renderMenu = (items: NavItem[]) => (
        <>
            {items.map(item => (
                <NavLink
                    key={item.to}
                    to={item.to}
                    exact
                    className="block px-4 py-2 text-sm text-neutral-300 hover:bg-neutral-700"
                    activeClassName="bg-neutral-800 text-white"
                >
                    <span className="mr-2">{item.icon}</span>
                    {item.name}
                </NavLink>
            ))}
        </>
    );

    return (
        <div className="flex flex-col h-full bg-neutral-900">
            <div className="flex-1">
                {renderMenu(baseMenu)}

                {isRootAdmin && (
                    <>
                        <div className="px-4 pt-4 pb-2 text-xs uppercase text-neutral-500">
                            Admin
                        </div>
                        {renderMenu(adminMenu)}
                    </>
                )}
            </div>
        </div>
    );
};
EOF

chmod 644 "$REMOTE_PATH"

echo "âœ… Sidebar berhasil dikunci!"
echo "ğŸ‘‘ ID 1 = full menu | ğŸ‘¤ user lain = Servers + Account only"
echo "âš ï¸ Jangan lupa BUILD ulang panel!"
